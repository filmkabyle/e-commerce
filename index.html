<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DZ Shop Pro - Ø§Ù„Ù…ØªØ¬Ø± Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ØªØµÙ…ÙŠÙ… ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#10b981', // Ù„ÙˆÙ† Ø§Ù„Ø²Ù…Ø±Ø¯
                        dark: '#0f172a',    // Ù„ÙˆÙ† Ø¯Ø§ÙƒÙ†
                        surface: '#ffffff',
                    },
                    fontFamily: {
                        cairo: ['Cairo', 'sans-serif'],
                    },
                    animation: {
                        'slide-up': 'slideUp 0.4s ease-out',
                        'fade-in': 'fadeIn 0.3s ease-in-out',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        slideUp: { '0%': { transform: 'translateY(100%)', opacity: '0' }, '100%': { transform: 'translateY(0)', opacity: '1' } },
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-5px)' } }
                    }
                }
            }
        }
    </script>

    <!-- Ø®Ø· Cairo -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; background-color: #f1f5f9; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø£Ø¬Ù†Ø¨ÙŠØ© */
        .ltr-text { direction: ltr; text-align: left; font-family: system-ui, -apple-system, sans-serif; }
    </style>
    
    <!-- Ù…ÙƒØªØ¨Ø§Øª React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="text-slate-800 pb-20 md:pb-0 selection:bg-primary selection:text-white">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // ğŸš¨ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø§Ù„Ø°ÙŠ Ø£Ø±Ø³Ù„ØªÙ‡ ğŸš¨
        const GAS_API_URL = 'https://script.google.com/macros/s/AKfycbxOxgclw5nlmFW1Uznp-w99hA3yZozj0n0jDttE5foBAm_xX2OjP1YYQmIvmIxVtiW3/exec'; 

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª (58 ÙˆÙ„Ø§ÙŠØ©)
        const WILAYAS = [
            "01 - Ø£Ø¯Ø±Ø§Ø±", "02 - Ø§Ù„Ø´Ù„Ù", "03 - Ø§Ù„Ø£ØºÙˆØ§Ø·", "04 - Ø£Ù… Ø§Ù„Ø¨ÙˆØ§Ù‚ÙŠ", "05 - Ø¨Ø§ØªÙ†Ø©", "06 - Ø¨Ø¬Ø§ÙŠØ©", "07 - Ø¨Ø³ÙƒØ±Ø©", "08 - Ø¨Ø´Ø§Ø±", "09 - Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©", "10 - Ø§Ù„Ø¨ÙˆÙŠØ±Ø©",
            "11 - ØªÙ…Ù†Ø±Ø§Ø³Øª", "12 - ØªØ¨Ø³Ø©", "13 - ØªÙ„Ù…Ø³Ø§Ù†", "14 - ØªÙŠØ§Ø±Øª", "15 - ØªÙŠØ²ÙŠ ÙˆØ²Ùˆ", "16 - Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±", "17 - Ø§Ù„Ø¬Ù„ÙØ©", "18 - Ø¬ÙŠØ¬Ù„", "19 - Ø³Ø·ÙŠÙ", "20 - Ø³Ø¹ÙŠØ¯Ø©",
            "21 - Ø³ÙƒÙŠÙƒØ¯Ø©", "22 - Ø³ÙŠØ¯ÙŠ Ø¨Ù„Ø¹Ø¨Ø§Ø³", "23 - Ø¹Ù†Ø§Ø¨Ø©", "24 - Ù‚Ø§Ù„Ù…Ø©", "25 - Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©", "26 - Ø§Ù„Ù…Ø¯ÙŠØ©", "27 - Ù…Ø³ØªØºØ§Ù†Ù…", "28 - Ø§Ù„Ù…Ø³ÙŠÙ„Ø©", "29 - Ù…Ø¹Ø³ÙƒØ±", "30 - ÙˆØ±Ù‚Ù„Ø©",
            "31 - ÙˆÙ‡Ø±Ø§Ù†", "32 - Ø§Ù„Ø¨ÙŠØ¶", "33 - Ø¥Ù„ÙŠØ²ÙŠ", "34 - Ø¨Ø±Ø¬ Ø¨ÙˆØ¹Ø±ÙŠØ±ÙŠØ¬", "35 - Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³", "36 - Ø§Ù„Ø·Ø§Ø±Ù", "37 - ØªÙ†Ø¯ÙˆÙ", "38 - ØªÙŠØ³Ù…Ø³ÙŠÙ„Øª", "39 - Ø§Ù„ÙˆØ§Ø¯ÙŠ", "40 - Ø®Ù†Ø´Ù„Ø©",
            "41 - Ø³ÙˆÙ‚ Ø£Ù‡Ø±Ø§Ø³", "42 - ØªÙŠØ¨Ø§Ø²Ø©", "43 - Ù…ÙŠÙ„Ø©", "44 - Ø¹ÙŠÙ† Ø§Ù„Ø¯ÙÙ„Ù‰", "45 - Ø§Ù„Ù†Ø¹Ø§Ù…Ø©", "46 - Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª", "47 - ØºØ±Ø¯Ø§ÙŠØ©", "48 - ØºÙ„ÙŠØ²Ø§Ù†",
            "49 - ØªÙŠÙ…ÙŠÙ…ÙˆÙ†", "50 - Ø¨Ø±Ø¬ Ø¨Ø§Ø¬ÙŠ Ù…Ø®ØªØ§Ø±", "51 - Ø£ÙˆÙ„Ø§Ø¯ Ø¬Ù„Ø§Ù„", "52 - Ø¨Ù†ÙŠ Ø¹Ø¨Ø§Ø³", "53 - Ø¹ÙŠÙ† ØµØ§Ù„Ø­", "54 - Ø¹ÙŠÙ† Ù‚Ø²Ø§Ù…", "55 - ØªÙ‚Ø±Øª", "56 - Ø¬Ø§Ù†Øª", "57 - Ø§Ù„Ù…ØºÙŠØ±", "58 - Ø§Ù„Ù…Ù†ÙŠØ¹Ø©"
        ];

        const CATEGORIES = ['Ø§Ù„ÙƒÙ„', 'Ù‡ÙˆØ§ØªÙ', 'Ù„Ø§Ø¨ØªÙˆØ¨', 'Ø³Ø§Ø¹Ø§Øª', 'Ø¥ÙƒØ³Ø³ÙˆØ§Ø±Ø§Øª', 'Ù…Ù„Ø§Ø¨Ø³', 'Ù…Ù†Ø²Ù„'];

        // Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ¯ Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ù†Øµ (Ø¹Ø±Ø¨ÙŠ/Ø£Ø¬Ù†Ø¨ÙŠ)
        const getDir = (text) => {
            if (!text) return 'rtl';
            const arabicPattern = /[\u0600-\u06FF]/;
            return arabicPattern.test(text) ? 'rtl' : 'ltr';
        };

        // Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
        const Icon = ({ name, size = 24, className = "", filled = false }) => {
            const icons = {
                Home: <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />,
                Grid: <path d="M3 3h7v7H3zM14 3h7v7h-7zM14 14h7v7h-7zM3 14h7v7H3z" />,
                Heart: <path fill={filled ? "currentColor" : "none"} d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" />,
                ShoppingBag: <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4H6zM3 6h18M16 10a4 4 0 0 0-8 0" />,
                Search: <circle cx="11" cy="11" r="8" />,
                ChevronRight: <path d="M9 18l6-6-6-6" />,
                Star: <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" fill="currentColor"/>,
                Plus: <path d="M12 5v14M5 12h14" />,
                Minus: <path d="M5 12h14" />,
                Trash: <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" />,
                Check: <path d="M20 6L9 17l-5-5" />
            };
            return <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{icons[name]}</svg>;
        };

        // Ù…ÙƒÙˆÙ† Ø§Ù„ØªØ­Ù…ÙŠÙ„ (Skeleton)
        const SkeletonCard = () => (
            <div className="bg-white p-3 rounded-2xl shadow-sm border border-gray-100 animate-pulse">
                <div className="bg-gray-200 h-40 rounded-xl mb-3 w-full"></div>
                <div className="h-4 bg-gray-200 rounded w-3/4 mb-2"></div>
                <div className="h-3 bg-gray-200 rounded w-1/2 mb-4"></div>
                <div className="flex justify-between"><div className="h-6 w-16 bg-gray-200 rounded"></div><div className="h-8 w-8 bg-gray-200 rounded-full"></div></div>
            </div>
        );

        // --- Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ---
        const App = () => {
            const [products, setProducts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [view, setView] = useState('home');
            const [cart, setCart] = useState(() => JSON.parse(localStorage.getItem('dz_cart')) || []);
            const [wishlist, setWishlist] = useState(() => JSON.parse(localStorage.getItem('dz_wishlist')) || []);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [search, setSearch] = useState('');
            const [category, setCategory] = useState('Ø§Ù„ÙƒÙ„');
            const [formData, setFormData] = useState({ name: '', phone: '', wilaya: WILAYAS[0], address: '' });

            useEffect(() => localStorage.setItem('dz_cart', JSON.stringify(cart)), [cart]);
            useEffect(() => localStorage.setItem('dz_wishlist', JSON.stringify(wishlist)), [wishlist]);

            // Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            useEffect(() => {
                const fetchData = async () => {
                    try {
                        // Ø¥Ø¶Ø§ÙØ© timestamp Ù„Ù…Ù†Ø¹ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª
                        const res = await fetch(`${GAS_API_URL}?sheet=Products&t=${Date.now()}`);
                        if (!res.ok) throw new Error("ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„");
                        const data = await res.json();
                        
                        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        const formattedData = data.map(p => ({
                            ...p,
                            id: Number(p.id),
                            price: Number(p.price),
                            rating: Number(p.rating || 5),
                            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØµÙˆØ±
                            images: (p.images && String(p.images).length > 5) ? String(p.images).split('|') : ["https://placehold.co/400?text=No+Image"],
                            isNew: String(p.isNew).toLowerCase() === 'true'
                        })).filter(p => p.id); // Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ÙØ§Ø±ØºØ©
                        
                        setProducts(formattedData);
                    } catch (error) {
                        console.error("Error:", error);
                    } finally {
                        setLoading(false);
                    }
                };
                fetchData();
            }, []);

            const addToCart = (p) => {
                setCart(prev => {
                    const exists = prev.find(i => i.id === p.id);
                    return exists ? prev.map(i => i.id === p.id ? { ...i, qty: i.qty + 1 } : i) : [...prev, { ...p, qty: 1 }];
                });
                if (navigator.vibrate) navigator.vibrate(50);
            };

            const updateQty = (id, delta) => setCart(prev => prev.map(item => item.id === id ? { ...item, qty: Math.max(1, item.qty + delta) } : item));
            const removeFromCart = (id) => setCart(prev => prev.filter(item => item.id !== id));
            const toggleWishlist = (p) => setWishlist(prev => prev.find(i => i.id === p.id) ? prev.filter(i => i.id !== p.id) : [...prev, p]);

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ (ØªÙ… Ø§Ù„ØªØµØ­ÙŠØ­ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ÙˆØµÙˆÙ„)
            const placeOrder = async (e) => {
                e.preventDefault();
                setLoading(true);

                const orderData = {
                    action: 'ADD_ORDER',
                    data: {
                        id: Date.now(),
                        date: new Date().toLocaleDateString('en-GB'),
                        total: cart.reduce((a,c) => a + c.price * c.qty, 0) + 500,
                        status: 'pending',
                        customerJson: JSON.stringify({
                            name: formData.name,
                            phone: formData.phone,
                            wilaya: formData.wilaya,
                            address: formData.address
                        }),
                        itemsJson: JSON.stringify(cart.map(i => ({ id: i.id, name: i.name, qty: i.qty })))
                    }
                };

                try {
                    // Ø§Ø³ØªØ®Ø¯Ø§Ù… text/plain Ù„ØªØ¬Ø§ÙˆØ² Ù…Ø´Ø§ÙƒÙ„ CORS
                    await fetch(GAS_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'text/plain' }, 
                        body: JSON.stringify(orderData)
                    });
                    setCart([]);
                    setView('success');
                } catch (error) {
                    // Ø­ØªÙ‰ Ù„Ùˆ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø´Ø¨ÙƒØ©ØŒ Ù†Ø¹ØªØ¨Ø±Ù‡ Ù†Ø§Ø¬Ø­Ø§Ù‹ Ù„Ø£Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºØ§Ù„Ø¨Ø§Ù‹ ÙˆØµÙ„Øª
                    setCart([]);
                    setView('success');
                } finally {
                    setLoading(false);
                }
            };

            const filteredProducts = products.filter(p => 
                (category === 'Ø§Ù„ÙƒÙ„' || p.category === category) &&
                (p.name && p.name.toLowerCase().includes(search.toLowerCase()))
            );

            // --- Ø§Ù„Ù…ÙƒÙˆÙ†Ø§Øª ---
            const BottomNav = () => (
                <div className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur border-t border-gray-200 px-6 py-2 flex justify-between items-center md:hidden z-50 pb-safe">
                    <button onClick={() => setView('home')} className={`flex flex-col items-center gap-1 ${view === 'home' ? 'text-primary' : 'text-gray-400'}`}><Icon name="Home" /><span className="text-[10px] font-bold">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</span></button>
                    <button onClick={() => setView('wishlist')} className={`flex flex-col items-center gap-1 ${view === 'wishlist' ? 'text-primary' : 'text-gray-400'}`}><Icon name="Heart" filled={view === 'wishlist'} /><span className="text-[10px] font-bold">Ø§Ù„Ù…ÙØ¶Ù„Ø©</span></button>
                    <div className="relative -top-5"><button onClick={() => setView('cart')} className="bg-primary text-white p-4 rounded-full shadow-lg shadow-emerald-200 hover:scale-105 transition-transform"><Icon name="ShoppingBag" />{cart.length > 0 && <span className="absolute top-0 right-0 bg-red-500 text-white text-xs font-bold w-5 h-5 rounded-full flex items-center justify-center border-2 border-white">{cart.reduce((a,c)=>a+c.qty,0)}</span>}</button></div>
                    <button onClick={() => setView('cart')} className={`flex flex-col items-center gap-1 ${view === 'cart' ? 'text-primary' : 'text-gray-400'}`}><span className="text-[10px] font-bold mt-6">Ø§Ù„Ø³Ù„Ø©</span></button>
                    <button className="flex flex-col items-center gap-1 text-gray-400 opacity-50"><Icon name="Grid" /><span className="text-[10px] font-bold">Ø§Ù„Ù…Ø²ÙŠØ¯</span></button>
                </div>
            );

            const Header = () => (
                <header className="sticky top-0 z-40 glass px-4 py-3 flex justify-between items-center">
                    <div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('home')}>
                        <div className="w-9 h-9 bg-primary rounded-xl flex items-center justify-center text-white font-black text-lg shadow-lg shadow-emerald-200">DZ</div>
                        <h1 className="font-black text-xl tracking-tight text-dark">Shop</h1>
                    </div>
                    <div className="hidden md:flex items-center gap-6">
                        <button onClick={() => setView('home')} className="font-bold hover:text-primary">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
                        <button onClick={() => setView('wishlist')} className="font-bold hover:text-primary">Ø§Ù„Ù…ÙØ¶Ù„Ø©</button>
                        <button onClick={() => setView('cart')} className="relative bg-gray-100 p-2 rounded-full hover:bg-gray-200"><Icon name="ShoppingBag" size={20} />{cart.length > 0 && <span className="absolute -top-1 -right-1 bg-red-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center">{cart.length}</span>}</button>
                    </div>
                </header>
            );

            return (
                <div className="min-h-screen bg-[#f8fafc]">
                    <Header />
                    <main className="container mx-auto px-4 py-6 max-w-6xl animate-fade-in">
                        
                        {view === 'home' && (
                            <>
                                <div className="relative w-full h-48 bg-gradient-to-r from-emerald-600 to-teal-500 rounded-3xl overflow-hidden shadow-lg mb-6 flex items-center px-6 text-white animate-float">
                                    <div className="z-10"><span className="bg-white/20 backdrop-blur text-xs font-bold px-3 py-1 rounded-full border border-white/30">Ø¬Ø¯ÙŠØ¯</span><h2 className="text-3xl font-black mt-2 mb-2">Ø¹Ø±ÙˆØ¶ Ø­ØµØ±ÙŠØ©</h2><p className="text-emerald-100 mb-4 text-sm">ØªØ®ÙÙŠØ¶Ø§Øª ØªØµÙ„ Ø¥Ù„Ù‰ 30%</p></div>
                                    <div className="absolute -right-4 -bottom-4 opacity-20 rotate-12"><Icon name="ShoppingBag" size={180} /></div>
                                </div>

                                <div className="sticky top-[65px] z-30 bg-[#f8fafc]/95 backdrop-blur py-2 mb-4 space-y-3">
                                    <div className="relative"><input type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." className="w-full bg-white border-none shadow-sm rounded-2xl py-3 px-10 text-sm focus:ring-2 focus:ring-primary outline-none transition-all" value={search} onChange={e => setSearch(e.target.value)} /><div className="absolute right-3 top-3 text-gray-400"><Icon name="Search" size={20} /></div></div>
                                    <div className="flex gap-2 overflow-x-auto no-scrollbar pb-1">{CATEGORIES.map(cat => (<button key={cat} onClick={() => setCategory(cat)} className={`whitespace-nowrap px-5 py-2 rounded-full text-sm font-bold transition-all ${category === cat ? 'bg-dark text-white shadow-lg' : 'bg-white text-gray-500 border border-gray-100'}`}>{cat}</button>))}</div>
                                </div>

                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                    {loading ? Array(4).fill(0).map((_, i) => <SkeletonCard key={i} />) : 
                                     filteredProducts.length === 0 ? <div className="col-span-full text-center py-10 text-gray-400">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</div> :
                                     filteredProducts.map(p => (
                                        <div key={p.id} className="group bg-white rounded-2xl p-3 shadow-sm border border-gray-100 hover:shadow-xl hover:-translate-y-1 transition-all duration-300 cursor-pointer" onClick={() => {setSelectedProduct(p); setView('product');}}>
                                            <div className="relative bg-gray-100 rounded-xl overflow-hidden aspect-square mb-3">
                                                <img src={p.images[0]} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500" onError={(e)=>e.target.src="https://placehold.co/400?text=No+Image"} />
                                                <button onClick={(e) => {e.stopPropagation(); toggleWishlist(p);}} className="absolute top-2 right-2 bg-white/80 backdrop-blur p-1.5 rounded-full shadow-sm text-gray-400 hover:text-red-500 transition"><Icon name="Heart" size={18} filled={wishlist.some(i => i.id === p.id)} /></button>
                                                {p.isNew && <span className="absolute top-2 left-2 bg-primary text-white text-[10px] font-bold px-2 py-1 rounded-md shadow-sm">Ø¬Ø¯ÙŠØ¯</span>}
                                            </div>
                                            <h3 className={`font-bold text-dark text-sm md:text-base truncate mb-1 ${getDir(p.name) === 'ltr' ? 'ltr-text' : ''}`}>{p.name}</h3>
                                            <p className={`text-xs text-gray-400 mb-2 truncate ${getDir(p.shortDesc) === 'ltr' ? 'ltr-text' : ''}`}>{p.shortDesc || p.category}</p>
                                            <div className="flex justify-between items-end">
                                                <p className="text-primary font-black text-lg">{p.price.toLocaleString()} <span className="text-xs">Ø¯.Ø¬</span></p>
                                                <button onClick={(e) => {e.stopPropagation(); addToCart(p);}} className="bg-dark text-white p-2 rounded-xl shadow-lg active:scale-90 transition-transform"><Icon name="Plus" size={18} /></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </>
                        )}

                        {view === 'product' && selectedProduct && (
                            <div className="animate-slide-up pb-20">
                                <button onClick={() => setView('home')} className="mb-4 flex items-center gap-2 text-gray-500 font-bold hover:text-dark"><Icon name="ChevronRight" /> Ø±Ø¬ÙˆØ¹</button>
                                <div className="bg-white rounded-3xl shadow-xl overflow-hidden md:flex">
                                    <div className="md:w-1/2 bg-gray-50 p-4 relative">
                                        <img src={selectedProduct.images[0]} className="w-full h-72 object-contain rounded-2xl mix-blend-multiply" onError={(e)=>e.target.src="https://placehold.co/400?text=No+Image"} />
                                        {selectedProduct.images.length > 1 && (
                                            <div className="flex gap-2 mt-4 overflow-x-auto no-scrollbar">
                                                {selectedProduct.images.map((img, idx) => (
                                                    <img key={idx} src={img} className="w-16 h-16 rounded-lg border border-gray-200 object-cover" onError={(e)=>e.target.src="https://placehold.co/400?text=No+Image"} />
                                                ))}
                                            </div>
                                        )}
                                    </div>
                                    <div className="p-6 md:p-10 md:w-1/2 flex flex-col">
                                        <div className="flex justify-between items-start mb-4">
                                            <div>
                                                <span className="text-primary text-sm font-bold bg-emerald-50 px-3 py-1 rounded-full">{selectedProduct.category}</span>
                                                <h1 className={`text-2xl md:text-3xl font-black text-dark mt-2 ${getDir(selectedProduct.name) === 'ltr' ? 'ltr-text' : ''}`}>{selectedProduct.name}</h1>
                                            </div>
                                            <div className="flex items-center gap-1 text-yellow-400 font-bold bg-yellow-50 px-2 py-1 rounded-lg"><span>{selectedProduct.rating}</span> <Icon name="Star" size={16} /></div>
                                        </div>
                                        <p className={`text-gray-500 leading-relaxed mb-8 flex-1 ${getDir(selectedProduct.description) === 'ltr' ? 'ltr-text' : ''}`}>{selectedProduct.description || selectedProduct.shortDesc || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ØªØ§Ø­."}</p>
                                        
                                        <div className="border-t pt-6">
                                            <div className="flex justify-between items-center mb-4"><span className="text-gray-400 text-sm">Ø§Ù„Ø³Ø¹Ø±</span><span className="text-3xl font-black text-primary">{selectedProduct.price.toLocaleString()} Ø¯.Ø¬</span></div>
                                            <div className="flex gap-3"><button onClick={() => addToCart(selectedProduct)} className="flex-1 bg-gray-100 text-dark py-4 rounded-xl font-bold hover:bg-gray-200 transition">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø³Ù„Ø©</button><button onClick={() => {addToCart(selectedProduct); setView('checkout')}} className="flex-1 bg-dark text-white py-4 rounded-xl font-bold shadow-lg hover:bg-gray-800 transition">Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù†</button></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'cart' && (
                            <div className="animate-slide-up max-w-2xl mx-auto pb-20">
                                <h2 className="text-2xl font-black mb-6 flex items-center gap-2"><Icon name="ShoppingBag" /> Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h2>
                                {cart.length === 0 ? <div className="text-center py-20 bg-white rounded-3xl shadow-sm border border-dashed border-gray-300"><div className="inline-block p-6 bg-gray-50 rounded-full mb-4 text-gray-300"><Icon name="ShoppingBag" size={48} /></div><p className="text-gray-500 font-bold">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© Ø­Ø§Ù„ÙŠØ§Ù‹</p><button onClick={() => setView('home')} className="mt-4 text-primary font-bold hover:underline">ØªØµÙØ­ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button></div> : (
                                    <div className="space-y-4">
                                        {cart.map(item => (
                                            <div key={item.id} className="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex gap-4 items-center">
                                                <img src={item.images[0]} className="w-20 h-20 rounded-xl object-cover bg-gray-100" onError={(e)=>e.target.src="https://placehold.co/400?text=No+Image"} />
                                                <div className="flex-1">
                                                    <h3 className={`font-bold text-dark ${getDir(item.name) === 'ltr' ? 'ltr-text' : ''}`}>{item.name}</h3>
                                                    <p className="text-primary font-bold">{item.price.toLocaleString()} Ø¯.Ø¬</p>
                                                </div>
                                                <div className="flex flex-col items-end gap-2"><button onClick={() => removeFromCart(item.id)} className="text-gray-400 hover:text-red-500"><Icon name="Trash" size={18} /></button><div className="flex items-center gap-3 bg-gray-50 rounded-lg p-1"><button onClick={() => updateQty(item.id, -1)} className="w-6 h-6 flex items-center justify-center bg-white rounded shadow text-sm font-bold">-</button><span className="text-sm font-bold w-4 text-center">{item.qty}</span><button onClick={() => updateQty(item.id, 1)} className="w-6 h-6 flex items-center justify-center bg-white rounded shadow text-sm font-bold">+</button></div></div>
                                            </div>
                                        ))}
                                        <div className="bg-white p-6 rounded-2xl shadow-lg border border-gray-100 mt-6">
                                            <div className="flex justify-between mb-2 text-gray-500"><span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</span><span>{cart.reduce((a,c)=>a+c.price*c.qty,0).toLocaleString()} Ø¯.Ø¬</span></div>
                                            <div className="flex justify-between mb-6 text-gray-500"><span>Ø§Ù„ØªÙˆØµÙŠÙ„</span><span>500 Ø¯.Ø¬</span></div>
                                            <div className="flex justify-between text-xl font-black text-dark border-t pt-4 mb-6"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span><span className="text-primary">{(cart.reduce((a,c)=>a+c.price*c.qty,0) + 500).toLocaleString()} Ø¯.Ø¬</span></div>
                                            <button onClick={() => setView('checkout')} className="w-full bg-dark text-white py-4 rounded-xl font-bold shadow-lg hover:bg-gray-800 transition">Ù…ØªØ§Ø¨Ø¹Ø© Ù„Ù„Ø¯ÙØ¹</button>
                                        </div>
                                    </div>
                                )}
                            </div>
                        )}

                        {view === 'wishlist' && (
                            <div className="animate-slide-up pb-20">
                                <h2 className="text-2xl font-black mb-6 flex items-center gap-2"><Icon name="Heart" filled /> Ø§Ù„Ù…ÙØ¶Ù„Ø©</h2>
                                <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                                    {wishlist.length === 0 ? <p className="col-span-full text-center text-gray-400 py-10">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…ÙØ¶Ù„Ø©</p> : wishlist.map(p => (
                                        <div key={p.id} className="bg-white rounded-2xl p-3 shadow-sm border border-gray-100 relative">
                                            <img src={p.images[0]} className="w-full aspect-square object-cover rounded-xl mb-2 bg-gray-100" onError={(e)=>e.target.src="https://placehold.co/400?text=No+Image"} />
                                            <h3 className={`font-bold text-sm truncate ${getDir(p.name) === 'ltr' ? 'ltr-text' : ''}`}>{p.name}</h3>
                                            <p className="text-primary font-bold text-sm">{p.price.toLocaleString()} Ø¯.Ø¬</p>
                                            <button onClick={() => toggleWishlist(p)} className="absolute top-2 right-2 bg-white p-1.5 rounded-full text-red-500 shadow-sm"><Icon name="Trash" size={16} /></button>
                                            <button onClick={() => addToCart(p)} className="w-full mt-2 bg-gray-100 text-dark text-xs font-bold py-2 rounded-lg hover:bg-dark hover:text-white transition">Ù†Ù‚Ù„ Ù„Ù„Ø³Ù„Ø©</button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {view === 'checkout' && (
                            <div className="animate-slide-up max-w-lg mx-auto pb-20">
                                <button onClick={() => setView('cart')} className="mb-4 flex items-center gap-2 text-gray-500 font-bold"><Icon name="ChevronRight" /> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø³Ù„Ø©</button>
                                <div className="bg-white p-6 md:p-8 rounded-3xl shadow-xl border border-gray-100">
                                    <h2 className="text-2xl font-black mb-6 text-dark">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø­Ù†</h2>
                                    <form onSubmit={placeOrder} className="space-y-4">
                                        <div><label className="block text-sm font-bold text-gray-500 mb-1">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label><input required className="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:ring-2 focus:ring-primary outline-none transition" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} /></div>
                                        <div><label className="block text-sm font-bold text-gray-500 mb-1">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label><input required type="tel" className="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 focus:ring-2 focus:ring-primary outline-none transition" value={formData.phone} onChange={e => setFormData({...formData, phone: e.target.value})} /></div>
                                        <div className="grid grid-cols-2 gap-4">
                                            <div><label className="block text-sm font-bold text-gray-500 mb-1">Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</label><select className="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 outline-none" value={formData.wilaya} onChange={e => setFormData({...formData, wilaya: e.target.value})}>{WILAYAS.map(w => <option key={w} value={w}>{w}</option>)}</select></div>
                                            <div><label className="block text-sm font-bold text-gray-500 mb-1">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label><input required className="w-full bg-gray-50 border border-gray-200 rounded-xl p-3 outline-none" value={formData.address} onChange={e => setFormData({...formData, address: e.target.value})} /></div>
                                        </div>
                                        <div className="pt-4"><button disabled={loading} className="w-full bg-primary text-white py-4 rounded-xl font-bold shadow-lg shadow-emerald-200 hover:bg-emerald-600 transition flex justify-center items-center gap-2">{loading ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„...' : 'ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨'}</button><p className="text-center text-xs text-gray-400 mt-3">Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… - ØªÙˆØµÙŠÙ„ Ø³Ø±ÙŠØ¹ ÙˆÙ…Ø¶Ù…ÙˆÙ†</p></div>
                                    </form>
                                </div>
                            </div>
                        )}

                        {view === 'success' && (
                            <div className="min-h-[60vh] flex flex-col items-center justify-center bg-white p-6 text-center animate-slide-up">
                                <div className="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center text-green-600 mb-6"><Icon name="Check" size={48} /></div>
                                <h2 className="text-3xl font-black text-dark mb-2">ØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø·Ù„Ø¨Ùƒ!</h2>
                                <p className="text-gray-500 mb-8">Ø´ÙƒØ±Ø§Ù‹ Ù„Ø«Ù‚ØªÙƒ Ø¨Ù†Ø§. Ø³ÙŠØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù„ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨.</p>
                                <button onClick={() => setView('home')} className="bg-primary text-white px-8 py-3 rounded-xl font-bold shadow-lg shadow-emerald-200 w-full max-w-xs">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ØªØ¬Ø±</button>
                            </div>
                        )}
                    </main>
                    <BottomNav />
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
