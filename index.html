<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>متجر الجزائر (DZ Shop) - الإصدار المطور</title>
    <!-- تضمين Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- إعداد خط Cairo -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body {
            font-family: 'Cairo', sans-serif;
            background-color: #f7f7f9;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .btn-primary {
            @apply bg-emerald-600 text-white font-bold rounded-xl transition-all duration-300 hover:bg-emerald-700 active:scale-[0.98];
        }
        .btn-secondary {
             @apply bg-gray-100 text-gray-800 font-bold rounded-xl transition-all duration-300 hover:bg-gray-200 active:scale-[0.98];
        }
        /* أنيميشن بسيط للظهور */
        .animate-fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
    
    <!-- مكتبات React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react.dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body>

    <div id="root">
        <!-- شاشة التحميل الأولية (تظهر حتى يعمل React) -->
        <div class="fixed inset-0 flex items-center justify-center bg-gray-50 z-[500]">
            <div class="text-center">
                <svg class="animate-spin h-12 w-12 text-emerald-600 mx-auto mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="text-gray-600 text-lg font-semibold">جارٍ تجهيز المتجر...</p>
            </div>
        </div>
    </div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // رابط API (إذا لم يعمل، سيتم استخدام البيانات التجريبية تلقائياً)
        const GAS_API_URL = 'https://script.google.com/macros/s/AKfycbwiaw6p3DKnwiICFV8YeC_RVcs6b_OLvyL__mVfRu-7eQLJA1BBOWe1w8oI0Z75EW0/exec'; 

        // --- البيانات الاحتياطية (Mock Data) ---
        const MOCK_PRODUCTS = [
            { id: 9001, name: "هاتف ذكي 5G جديد", price: 125000, category: "إلكترونيات", images: ["https://placehold.co/400x400/10b981/ffffff?text=Phone+5G"], rating: 4.8, reviews: 55, isNew: true, shortDesc: "شاشة AMOLED وكاميرا 108MP.", description: "هاتف قوي بأداء ممتاز وشحن فائق السرعة." }, 
            { id: 9002, name: "ساعة ذكية رياضية", price: 15000, category: "إكسسوارات", images: ["https://placehold.co/400x400/ef4444/ffffff?text=Smart+Watch"], rating: 4.5, reviews: 80, isNew: false, shortDesc: "تتبع اللياقة البدنية والقلب.", description: "ساعة مقاومة للماء مع عمر بطارية طويل." },
            { id: 9003, name: "سماعات بلوتوث Pro", price: 8500, category: "إلكترونيات", images: ["https://placehold.co/400x400/3b82f6/ffffff?text=Earbuds"], rating: 4.2, reviews: 30, isNew: true, shortDesc: "عزل ضوضاء وصوت محيطي.", description: "تجربة صوتية غامرة مع بطارية تدوم طويلاً." },
            { id: 9004, name: "حقيبة ظهر عصرية", price: 4500, category: "ملابس", images: ["https://placehold.co/400x400/f59e0b/ffffff?text=Backpack"], rating: 4.7, reviews: 120, isNew: false, shortDesc: "مقاومة للماء ومتعددة الجيوب.", description: "مثالية للسفر والعمل والدراسة." }
        ];
        const MOCK_ORDERS = [];

        // === تعريف الأيقونات ===
        const Icon = ({ icon, size = 24, className = "" }) => {
            const icons = {
                ShoppingCart: <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4H6zM3 6h18M6 10h12" />,
                X: <path d="M18 6L6 18M6 6l12 12" />,
                Search: <path d="M11 17a6 6 0 1 0 0-12 6 6 0 0 0 0 12zM15 15l4 4" />,
                Phone: <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.08 2H7v1.73a1 1 0 0 1-1 1A14.2 14.2 0 0 0 4 12a14.2 14.2 0 0 0 6.27 1.77 1 1 0 0 1 1 1V19z" />,
                CheckCircle: <path d="M22 11.08V12a10 10 0 1 1-5.05-8.83M13 3v8h8" />,
                Truck: <path d="M10 17H6a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-4v-5h-4v5zM6 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4zM16 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4z" />,
                Star: <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />,
                ArrowRight: <path d="M5 12h14M12 5l7 7-7 7" />,
                ShieldCheck: <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10zM9 12l2 2 4-4" />,
                LayoutDashboard: <rect x="3" y="3" width="7" height="9" /><rect x="14" y="3" width="7" height="5" /><rect x="14" y="11" width="7" height="9" /><rect x="3" y="15" width="7" height="5" />,
                Package: <path d="M12.89 1.45l8 4.5A2 2 0 0 1 22 7.7V17a2 2 0 0 1-1.11 1.74l-8 4.5a2 2 0 0 1-1.78 0l-8-4.5A2 2 0 0 1 2 17V7.7a2 2 0 0 1 1.11-1.75l8-4.5a2 2 0 0 1 1.78 0zM12 20.5v-8.5" />,
                ShoppingBag: <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4H6zM3 6h18M16 10a4 4 0 0 0-8 0" />,
                Plus: <path d="M12 5v14M5 12h14" />,
                Minus: <path d="M5 12h14" />,
                Trash2: <path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6" />,
                LogOut: <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4m7 14l5-5-5-5M21 12H9" />,
                DollarSign: <line x1="12" y1="1" x2="12" y2="23" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" />,
                Loader2: <path d="M21 12a9 9 0 1 1-6.219-8.56" />,
                AlertCircle: <circle cx="12" cy="12" r="10" /><line x1="12" y1="8" x2="12" y2="12" /><line x1="12" y1="16" x2="12" y2="16" />,
            };

            const path = icons[icon];
            if (!path) return <span style={{ width: size, height: size }}>{icon}</span>;
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                    {path}
                </svg>
            );
        };

        const WILAYAS = ["01 - أدرار", "02 - الشلف", "09 - البليدة", "16 - الجزائر", "25 - قسنطينة", "31 - وهران", "34 - برج بوعريريج", "35 - بومرداس", "42 - تيبازة", "44 - عين الدفلى", "58 - المنيعة"].sort();
        const PRODUCT_CATEGORIES = ['كل الفئات', 'إلكترونيات', 'ملابس', 'إكسسوارات', 'عناية شخصية', 'منزل ومطبخ'];

        const showNotification = (message, type = 'green') => {
            const box = document.getElementById('message-box');
            if (!box) return;
            const baseClasses = "text-white p-3 rounded-xl fixed bottom-5 left-1/2 -translate-x-1/2 shadow-xl z-[300] font-bold text-sm transition-opacity duration-300";
            let colorClasses = type === 'red' ? 'bg-red-600' : type === 'yellow' ? 'bg-yellow-600' : 'bg-green-600';
            box.innerHTML = `<div class="${baseClasses} ${colorClasses} opacity-0">${message}</div>`;
            const newToast = box.firstChild;
            setTimeout(() => newToast.classList.remove('opacity-0'), 10);
            setTimeout(() => { newToast.classList.add('opacity-0'); setTimeout(() => box.innerHTML = '', 300); }, 4000);
        };

        // --- المكون الرئيسي ---
        const App = () => {
            const [products, setProducts] = useState([]);
            const [orders, setOrders] = useState([]);
            const [view, setView] = useState('home');
            const [cart, setCart] = useState([]);
            const [isCartOpen, setIsCartOpen] = useState(false);
            const [selectedProduct, setSelectedProduct] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            const [errorMsg, setErrorMsg] = useState(null);
            const [searchTerm, setSearchTerm] = useState('');
            const [filterCategory, setFilterCategory] = useState('كل الفئات');
            const [sortBy, setSortBy] = useState('newest');
            const [isAdminAuthenticated, setIsAdminAuthenticated] = useState(false);
            const [adminPass, setAdminPass] = useState('');
            const [adminTab, setAdminTab] = useState('dashboard');
            const [newProduct, setNewProduct] = useState({ name: '', price: '', category: 'إلكترونيات', images: '', shortDesc: '', description: '' });
            const [formData, setFormData] = useState({ fullName: '', phone: '', wilaya: WILAYAS[0] || '', commune: '', address: '' });

            // دالة جلب البيانات مع مهلة زمنية (Timeout) لتجنب التعليق
            const fetchData = useCallback(async (sheetName) => {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 5000); // مهلة 5 ثواني

                try {
                    const response = await fetch(`${GAS_API_URL}?sheet=${sheetName}`, { signal: controller.signal });
                    clearTimeout(timeoutId);
                    if (!response.ok) throw new Error("HTTP Error");
                    return await response.json();
                } catch (error) {
                    throw error;
                }
            }, []);

            const sendData = async (action, data) => {
                setIsLoading(true);
                try {
                    const response = await fetch(GAS_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ action, data }),
                    });
                    const result = await response.json();
                    if (!result.success) throw new Error(result.error || 'فشل');
                    return result;
                } catch (error) {
                    showNotification(`فشل العملية: ${error.message}`, 'red');
                    return { success: false };
                } finally {
                    setIsLoading(false);
                }
            };

            // --- تحميل البيانات الأولي ---
            const loadInitialData = useCallback(async () => {
                setIsLoading(true);
                setErrorMsg(null);
                
                try {
                    // محاولة جلب البيانات
                    const [fetchedProducts, fetchedOrders] = await Promise.all([
                        fetchData('Products'),
                        fetchData('Orders')
                    ]);

                    setProducts(fetchedProducts.map(p => ({
                        ...p, 
                        id: Number(p.id),
                        price: Number(p.price),
                        rating: Number(p.rating || 5.0),
                        reviews: Number(p.reviews || 0),
                        images: (p.images && typeof p.images === 'string') ? p.images.split('|').map(url => url.trim()).filter(url => url) : (Array.isArray(p.images) ? p.images : ["https://placehold.co/400x400/f3f4f6/a3a3a3?text=DZ"]),
                        isNew: String(p.isNew).toLowerCase() === 'true',
                    })));
                    
                    setOrders(fetchedOrders.map(o => {
                        let items = [], customer = {};
                        try { items = JSON.parse(o.itemsJson || '[]'); } catch (e) {}
                        try { customer = JSON.parse(o.customerJson || '{}'); } catch (e) {}
                        return { ...o, id: Number(o.id), total: Number(o.total), items, customer };
                    }));
                    showNotification('تم الاتصال بقاعدة البيانات.', 'green');

                } catch (error) {
                    console.warn("فشل الاتصال، استخدام بيانات وهمية:", error);
                    // في حالة الفشل، استخدم البيانات الوهمية فوراً
                    setProducts(MOCK_PRODUCTS);
                    setOrders(MOCK_ORDERS);
                    showNotification('وضع العرض التجريبي (لم يتم الاتصال بالخادم).', 'yellow');
                } finally {
                    setIsLoading(false);
                }
            }, [fetchData]);

            useEffect(() => {
                loadInitialData();
            }, [loadInitialData]);

            // --- دوال السلة ---
            const updateCartQuantity = (id, change) => {
                setCart(prev => prev.map(item => item.id === id ? { ...item, qty: item.qty + change } : item).filter(item => item.qty > 0));
            };
            const addToCart = (product) => {
                setCart(prev => {
                    const existing = prev.find(item => item.id === product.id);
                    if (existing) {
                        showNotification(`تم تحديث الكمية: ${product.name}`, 'green');
                        return prev.map(item => item.id === product.id ? { ...item, qty: item.qty + 1 } : item);
                    }
                    showNotification(`أضيف للسلة: ${product.name}`, 'green');
                    return [...prev, { ...product, qty: 1 }];
                });
                setIsCartOpen(true);
            };

            // --- تصفية وفرز ---
            const filteredAndSortedProducts = useMemo(() => {
                let filtered = products.filter(p => 
                    (filterCategory === 'كل الفئات' || p.category === filterCategory) &&
                    (p.name.toLowerCase().includes(searchTerm.toLowerCase()))
                );
                if (sortBy === 'price_asc') filtered.sort((a, b) => a.price - b.price);
                else if (sortBy === 'price_desc') filtered.sort((a, b) => b.price - a.price);
                else filtered.sort((a, b) => (b.isNew ? 1 : 0) - (a.isNew ? 1 : 0));
                return filtered;
            }, [products, searchTerm, filterCategory, sortBy]);

            const getShippingCost = (wilaya) => {
                if (!wilaya) return 0;
                if (wilaya.includes('الجزائر') || wilaya.includes('البليدة') || wilaya.includes('بومرداس') || wilaya.includes('تيبازة')) return 400;
                return 800;
            };

            // --- واجهة المستخدم ---
            const LoadingOverlay = () => (
                <div className="fixed inset-0 bg-white/80 backdrop-blur-sm z-[200] flex items-center justify-center" dir="rtl">
                    <div className="flex items-center gap-3 bg-gray-900 text-white p-4 rounded-full shadow-lg">
                        <Icon icon="Loader2" className="animate-spin" size={24} />
                        <span className="font-bold">جارٍ المعالجة...</span>
                    </div>
                </div>
            );

            const Navbar = () => (
                <nav className="sticky top-0 z-50 bg-white/90 backdrop-blur-md shadow-sm border-b border-gray-100">
                    <div className="container mx-auto px-4 py-3 flex items-center justify-between">
                        <div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('home')}>
                            <div className="bg-emerald-600 text-white p-2 rounded-xl font-black text-xl">DZ</div>
                            <h1 className="text-xl font-black text-gray-900 tracking-tighter hidden sm:block">سوق الجزائر</h1>
                        </div>
                        {view.includes('admin') ? (
                            <div className="bg-gray-900 text-white px-3 py-1 rounded-full text-xs font-bold">لوحة الإدارة</div>
                        ) : (
                            <button className="relative p-2.5 hover:bg-emerald-50 text-emerald-700 rounded-full transition-colors" onClick={() => setIsCartOpen(true)}>
                                <Icon icon="ShoppingCart" className="w-6 h-6" />
                                {cart.length > 0 && <span className="absolute top-1 right-1 bg-red-500 text-white text-[10px] font-bold w-4 h-4 flex items-center justify-center rounded-full animate-bounce">{cart.reduce((a, c) => a + c.qty, 0)}</span>}
                            </button>
                        )}
                    </div>
                </nav>
            );

            // --- العرض الرئيسي ---
            return (
                <div className="min-h-screen text-gray-800 font-sans" dir="rtl">
                    {isLoading && <LoadingOverlay />}
                    <div id="message-box"></div> 
                    <Navbar />
                    
                    {view === 'home' && (
                        <main className="container mx-auto px-4 py-6 animate-fade-in">
                            <div className="bg-gray-900 rounded-3xl p-8 mb-8 text-white shadow-xl relative overflow-hidden">
                                <div className="relative z-10 max-w-2xl">
                                    <h2 className="text-3xl font-bold mb-4">عروض حصرية وتوصيل سريع</h2>
                                    <p className="text-gray-400 mb-6">تسوق الآن وادفع عند الاستلام في جميع ولايات الجزائر.</p>
                                </div>
                            </div>

                            <div className="flex flex-col md:flex-row gap-3 mb-6 items-center">
                                <div className="flex-1 relative w-full">
                                     <input type="text" placeholder="بحث..." className="w-full bg-white border border-gray-200 rounded-xl py-2.5 px-4 pr-10 focus:ring-2 focus:ring-emerald-500" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} />
                                    <Icon icon="Search" className="absolute left-3 top-2.5 text-gray-400 w-5 h-5" />
                                </div>
                                <select className="bg-white border border-gray-200 p-3 rounded-xl w-full md:w-auto text-sm" value={filterCategory} onChange={(e) => setFilterCategory(e.target.value)}>
                                    {PRODUCT_CATEGORIES.map(cat => <option key={cat} value={cat}>{cat}</option>)}
                                </select>
                            </div>
                            
                            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-4">
                                {filteredAndSortedProducts.map(product => (
                                    <div key={product.id} className="bg-white rounded-2xl p-3 shadow-sm border border-gray-100 hover:shadow-lg transition-all cursor-pointer group" onClick={() => { setSelectedProduct(product); setView('product-detail'); }}>
                                        <div className="relative rounded-xl overflow-hidden mb-3 aspect-square bg-gray-100">
                                            <img src={product.images[0]} alt={product.name} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500" onError={(e) => e.target.src="https://placehold.co/200x200/f3f4f6/a3a3a3?text=No+Image"}/>
                                            {product.isNew && <span className="absolute top-2 right-2 bg-red-500 text-white text-[10px] font-bold px-2 py-0.5 rounded-full">جديد</span>}
                                        </div>
                                        <h3 className="font-bold text-gray-900 text-sm md:text-base mb-1 truncate">{product.name}</h3>
                                        <div className="flex justify-between items-center">
                                            <span className="text-emerald-700 font-bold">{product.price.toLocaleString()} د.ج</span>
                                            <button onClick={(e) => {e.stopPropagation(); addToCart(product);}} className="p-2 rounded-full bg-emerald-50 text-emerald-600 hover:bg-emerald-600 hover:text-white transition-colors"><Icon icon="Plus" size={16}/></button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </main>
                    )}

                    {view === 'product-detail' && selectedProduct && (
                        <div className="container mx-auto px-4 py-8 animate-fade-in max-w-5xl">
                            <button onClick={() => setView('home')} className="mb-4 flex items-center gap-2 text-gray-500"><Icon icon="ArrowRight" size={20}/> رجوع</button>
                            <div className="bg-white p-6 rounded-3xl shadow-lg border border-gray-100 grid md:grid-cols-2 gap-8">
                                <img src={selectedProduct.images[0]} className="w-full rounded-2xl bg-gray-100 object-cover aspect-square" alt={selectedProduct.name} onError={(e) => e.target.src="https://placehold.co/400x400/f3f4f6/a3a3a3?text=No+Image"}/>
                                <div>
                                    <h1 className="text-2xl md:text-3xl font-black mb-2">{selectedProduct.name}</h1>
                                    <div className="flex items-center gap-1 text-yellow-500 mb-4"><Icon icon="Star" size={18} fill="currentColor"/><span className="text-gray-500 text-sm">({selectedProduct.reviews} تقييم)</span></div>
                                    <p className="text-gray-600 mb-6 leading-relaxed">{selectedProduct.description}</p>
                                    <div className="flex items-center justify-between border-t pt-4 mt-auto">
                                        <span className="text-3xl font-black text-emerald-600">{selectedProduct.price.toLocaleString()} د.ج</span>
                                        <button onClick={() => addToCart(selectedProduct)} className="px-8 py-3 btn-primary flex items-center gap-2"><Icon icon="ShoppingCart" size={20}/> إضافة للسلة</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {view === 'checkout' && (
                        <div className="container mx-auto px-4 py-8 max-w-2xl animate-fade-in">
                            <button onClick={() => setView('home')} className="mb-4 flex items-center gap-2 text-gray-500"><Icon icon="ArrowRight" size={20}/> رجوع</button>
                            <div className="bg-white p-6 rounded-2xl shadow-lg border border-gray-100">
                                <h2 className="text-2xl font-bold mb-6">إتمام الطلب</h2>
                                <div className="mb-6 bg-gray-50 p-4 rounded-xl">
                                    <div className="flex justify-between mb-2"><span>المجموع</span><span>{cart.reduce((a,c) => a + (c.price*c.qty),0).toLocaleString()} د.ج</span></div>
                                    <div className="flex justify-between mb-2"><span>التوصيل</span><span>{getShippingCost(formData.wilaya).toLocaleString()} د.ج</span></div>
                                    <div className="flex justify-between font-bold text-xl border-t pt-2 mt-2"><span>الإجمالي</span><span className="text-emerald-600">{(cart.reduce((a,c) => a + (c.price*c.qty),0) + getShippingCost(formData.wilaya)).toLocaleString()} د.ج</span></div>
                                </div>
                                <form onSubmit={(e) => { e.preventDefault(); if(cart.length===0) return; setView('success'); setCart([]); }} className="space-y-4">
                                    <input required placeholder="الاسم الكامل" className="w-full bg-gray-50 p-3 rounded-xl" value={formData.fullName} onChange={e => setFormData({...formData, fullName: e.target.value})} />
                                    <input required placeholder="رقم الهاتف" type="tel" className="w-full bg-gray-50 p-3 rounded-xl" value={formData.phone} onChange={e => setFormData({...formData, phone: e.target.value})} />
                                    <select required className="w-full bg-gray-50 p-3 rounded-xl" value={formData.wilaya} onChange={e => setFormData({...formData, wilaya: e.target.value})}>
                                        <option value="" disabled>اختر الولاية</option>
                                        {WILAYAS.map(w => <option key={w} value={w}>{w}</option>)}
                                    </select>
                                    <input required placeholder="العنوان والبلدية" className="w-full bg-gray-50 p-3 rounded-xl" value={formData.address} onChange={e => setFormData({...formData, address: e.target.value})} />
                                    <button className="w-full py-4 btn-primary text-lg mt-4">تأكيد الطلب</button>
                                </form>
                            </div>
                        </div>
                    )}

                    {view === 'success' && (
                        <div className="min-h-[60vh] flex flex-col items-center justify-center text-center p-4 animate-fade-in">
                            <div className="w-20 h-20 bg-green-100 rounded-full flex items-center justify-center text-green-600 mb-6"><Icon icon="CheckCircle" size={40}/></div>
                            <h2 className="text-3xl font-bold mb-2">تم استلام طلبك!</h2>
                            <p className="text-gray-500 mb-8">سنتصل بك قريباً لتأكيد الطلب.</p>
                            <button onClick={() => setView('home')} className="px-8 py-3 btn-primary rounded-full">العودة للرئيسية</button>
                        </div>
                    )}

                    {view === 'admin-login' && (
                        <div className="min-h-screen flex items-center justify-center p-4">
                            <div className="bg-white p-8 rounded-2xl shadow-xl max-w-sm w-full">
                                <h2 className="text-2xl font-bold text-center mb-6">دخول المشرف</h2>
                                <form onSubmit={(e) => { e.preventDefault(); if(adminPass==='1234'){setIsAdminAuthenticated(true); setView('admin-dashboard');} else showNotification('كلمة المرور خطأ','red'); }}>
                                    <input type="password" placeholder="كلمة المرور" className="w-full bg-gray-50 border p-3 rounded-lg mb-4" value={adminPass} onChange={e => setAdminPass(e.target.value)} />
                                    <button className="w-full py-3 btn-primary">دخول</button>
                                    <button type="button" onClick={() => setView('home')} className="w-full mt-4 text-sm text-gray-500">عودة</button>
                                </form>
                            </div>
                        </div>
                    )}

                    {view === 'admin-dashboard' && (
                        <div className="container mx-auto p-4">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-2xl font-bold">لوحة التحكم</h2>
                                <button onClick={() => setView('home')} className="text-red-500 font-bold text-sm">خروج</button>
                            </div>
                            <div className="bg-white p-6 rounded-xl shadow text-center">
                                <p className="text-gray-500">مرحباً بك في لوحة التحكم. (نسخة مبسطة)</p>
                                <div className="grid grid-cols-2 gap-4 mt-4">
                                    <div className="bg-blue-50 p-4 rounded-xl">
                                        <h3 className="font-bold text-blue-700">الطلبات</h3>
                                        <p className="text-2xl font-black">{orders.length}</p>
                                    </div>
                                    <div className="bg-emerald-50 p-4 rounded-xl">
                                        <h3 className="font-bold text-emerald-700">المنتجات</h3>
                                        <p className="text-2xl font-black">{products.length}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Cart Sidebar */}
                    {isCartOpen && (
                        <div className="fixed inset-0 z-[100] flex justify-end">
                            <div className="absolute inset-0 bg-black/40 backdrop-blur-sm" onClick={() => setIsCartOpen(false)}></div>
                            <div className="relative bg-white w-full max-w-md h-full shadow-2xl p-6 flex flex-col animate-fade-in">
                                <div className="flex justify-between items-center mb-6 border-b pb-3">
                                    <h2 className="text-2xl font-black">السلة</h2>
                                    <button onClick={() => setIsCartOpen(false)}><Icon icon="X" className="text-gray-500"/></button>
                                </div>
                                <div className="flex-1 overflow-y-auto hide-scrollbar space-y-4">
                                    {cart.length === 0 ? <p className="text-center text-gray-500 mt-10">السلة فارغة</p> : cart.map(item => (
                                        <div key={item.id} className="flex gap-4 border-b pb-4 items-center">
                                            <img src={item.images[0]} className="w-16 h-16 rounded-xl object-cover bg-gray-50" onError={(e) => e.target.src="https://placehold.co/40x40"}/>
                                            <div className="flex-1">
                                                <h4 className="font-bold text-sm">{item.name}</h4>
                                                <p className="text-emerald-600 font-bold">{item.price.toLocaleString()} د.ج</p>
                                            </div>
                                            <div className="flex items-center gap-2 bg-gray-100 p-1 rounded-full">
                                                <button onClick={() => updateCartQuantity(item.id, 1)} className="p-1 bg-white rounded-full"><Icon icon="Plus" size={14}/></button>
                                                <span className="font-bold text-sm w-4 text-center">{item.qty}</span>
                                                <button onClick={() => updateCartQuantity(item.id, -1)} className="p-1 bg-white rounded-full"><Icon icon="Minus" size={14}/></button>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                {cart.length > 0 && (
                                    <button onClick={() => {setIsCartOpen(false); setView('checkout')}} className="w-full py-3 btn-primary text-lg mt-4">إتمام الشراء</button>
                                )}
                            </div>
                        </div>
                    )}

                    <footer className="mt-10 py-6 text-center text-gray-400 text-sm border-t">
                        <p>© 2024 DZ Shop. <span className="cursor-pointer hover:text-emerald-600" onClick={() => setView('admin-login')}>دخول الإدارة</span></p>
                    </footer>
                </div>
            );
        };

        // === تشغيل التطبيق (React 18) ===
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
